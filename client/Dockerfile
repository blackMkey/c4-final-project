FROM node:14-alpine AS build
ENV REACT_APP_DEV_FRONTEND_ENV_API_ID=$REACT_APP_DEV_FRONTEND_ENV_API_ID
ENV REACT_APP_DEV_FRONTEND_ENV_DOMAIN=$REACT_APP_DEV_FRONTEND_ENV_DOMAIN
ENV REACT_APP_DEV_FRONTEND_ENV_CLIENT_ID=$REACT_APP_DEV_FRONTEND_ENV_CLIENT_ID
WORKDIR /build

COPY package.json package.json
COPY package-lock.json package-lock.json
RUN npm ci

COPY public/ public
COPY src/ src
RUN npm run build


# Stage 2
FROM nginx:alpine
ENV REACT_APP_DEV_FRONTEND_ENV_API_ID=$REACT_APP_DEV_FRONTEND_ENV_API_ID
ENV REACT_APP_DEV_FRONTEND_ENV_DOMAIN=$REACT_APP_DEV_FRONTEND_ENV_DOMAIN
ENV REACT_APP_DEV_FRONTEND_ENV_CLIENT_ID=$REACT_APP_DEV_FRONTEND_ENV_CLIENT_ID
COPY --from=build /build/build/ /usr/share/nginx/html